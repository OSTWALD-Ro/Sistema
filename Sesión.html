<!DOCTYPE html>
<html>
  <head>
    <title id=title></title>
    <style id=styles></style>
  </head>
  <body>
    <script>

      'use strict';

      var testMode = false; // false Modo Normal | true Modo Prueba

      var currentURL = window.location.href;
      var mainURL = "https://ostwald-ro.github.io/Sistema/Sesión";
      var mainURLError = "https://ostwald-ro.github.io/Sistema/Sesi%C3%B3n";
      // var mainURLErrorHTML = "https://ostwald-ro.github.io/Sistema/Sesi%C3%B3n.html";

      var alternativeFunctions = true; // Funciones Alternativas | false true

      var fileName, segundosReintentando, s;
      var segundo = 1000;
    
      const container = document.createElement("div");
      const message = document.createElement("p");

      function end(_blank)
      {

        if (
            alternativeFunctions === true
           )
        {
          if (
              testMode !== true
             )
          {
            window.location.href = mainURL;
          } else
          {
            // window.location.href = currentURL;
            location.reload(true);
          }
        } else 
        {


            // location.reload(true);

          if (
              _blank === true
             )
          {

            if (
                testMode !== true
               )
            {
              window.open(mainURL, '_blank');
            } else
            {
              window.open(currentURL, '_blank');
            }

          } else
          {

            if (
                testMode !== true
               )
            {
              window.open(mainURL);
            } else
            {
              window.open(currentURL);
            }

          }
          window.close();
        }
      }
      
      function localizarArchivo() 
      {
        function archivoAusente() 
        {
          
                message.textContent = "Archivo Ausente.";  container.appendChild(message);

          setTimeout(function()
          {
            segundosReintentando = (10);

            // while (segundosReintentando > 0) {}
          
              setInterval(function() 
              {
                if (segundosReintentando >= 0)
                {
                  if (segundosReintentando == 1)
                  {
                    s = "";
                  } else 
                  {
                    s = "s";
                  }

                  message.textContent = "Reintentando en " + (segundosReintentando) + " segundo" + s + "...";
                  container.appendChild(message);

                  segundosReintentando = (segundosReintentando - 1);
                } else 
                {
                  s,  segundosReintentando = "";

                  if (segundosReintentando == 0) 
                  {
                    end(true);
                  }
                }
              }, segundo);
          }, segundo);          
        }

        message.textContent = "Localizando Archivo...";  container.appendChild(message);
      
        setTimeout(function() 
        {
          fetch(fileName)
          .then(response => response.text())
          .then(data => 
          {
            var linesTitlesTable = 1;
            var userLinesTable = 1;
            var passwordLinesTable = 2;

            var ID = 1;

            // Dividir el contenido del archivo en líneas
            var lines = data.split("\n");

            // Dividir en palabras un renglón
            var lineWords = lines[(1)-linesTitlesTable].split(" ");
          
            // lineWords[2];

            var usuario = data.split("\n")[(ID)+(linesTitlesTable)-1].split(" ")[(userLinesTable)-1];
            var contraseña = data.split("\n")[(ID)+(linesTitlesTable)-1].split(" ")[(passwordLinesTable)-1];

            message.textContent = "Archivo Localizado.";  container.appendChild(message);
            
            setTimeout(function() 
            {
              if (
                  testMode === true
                 )
              {
                message.textContent = usuario + " " + contraseña;  container.appendChild(message);
              
                setTimeout(function()
                {
                  // end(true);
                }, segundo);
              }
            }, segundo);
          })
          .catch(error => {
              archivoAusente();
          });
        }, segundo);
      }

      function init() 
      {
        fileName = "https://ostwald-ro.github.io/Sistema/ID.txt";
        localizarArchivo();
      }
      
      if (
          testMode === true
         )
      {
        mainURLError = currentURL;
        alternativeFunctions = false;
      }
      
      if (
          currentURL !== mainURLError
         )
      {
        end();
      }

      document.addEventListener("DOMContentLoaded", function() 
      {
        const styles = document.getElementById("styles");
        const title = document.getElementById("title");
      
        styles.innerHTML = `
          body, html {
            margin: 0;
            padding: 0;
            text-align: center;
            background-color: black;
            color: white;
            align-items: center;
            justify-content: center;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
          }
        `;

        document.title = "Sesión";
        title.innerHTML = "Sesión";

        if (
            currentURL === mainURLError
           )
        {
          // Si se abrio desde la URL Original      
          init();
        } else 
        {
          // Si se abrio desde otra URL
        }

        document.body.appendChild(container);
      });
    </script>
  </body>
</html>
